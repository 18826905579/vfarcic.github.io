<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Microservices Lifecycle</title>

		<meta name="author" content="Viktor Farcic">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/viktor.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section id="cover">
					<h1>Microservices Lifecycle</h1>
					<p>
						<small>
							Created by <a href="http://technologyconversations.com/about/">Viktor Farcic</a>
							for <a href="http://technologyconversations.com">Technology Conversations</a> / <a href="http://twitter.com/vfarcic">@vfarcic</a>
						</small>
					</p>
				</section>
				<section id="about-me">
					<h2>Viktor Farcic</h2>
					<ul>
						<img src="img/viktor.jpg" style="float: right; width: 25%; height: 25%;"/>
						<li>Software Architect at <a href="http://everis.com">Everis</a></li>
						<li>Never developed in Fortran</li>
						<li>Passionate about microservices, continuous delivery, TDD, and BDD</li>
						<li>Blogger in <a href="http://technologyconversations.com/">Technology Conversations</a> and speaker at conferences</li>
						<li>Java Test-Driven Development: Mastering TDD Through Katas</li>
					</ul>
				</section>
				<section id="failures">
					<h2>History of the Failed Initiatives</h2>
					<h4>Continuous Integration (CI), Delivery and Deployment (CD)</h4>
					<ul>
						<li class="fragment">Integration phase = Dante's Infierno</li>
						<li class="fragment">eXtreme programming (XP)</li>
						<li class="fragment">Architecture</li>
						<li class="fragment">Testing</li>
						<li class="fragment">Orchestration</li>
						<li class="fragment">Deployments</li>
					</ul>
				</section>
				<section id="history">
					<h2>Things in Common</h2>
					<ul>
						<li class="fragment">Domain-driven design</li>
						<li class="fragment">Continuous delivery</li>
						<li class="fragment">Containers</li>
						<li class="fragment">Small autonomous teams</li>
						<li class="fragment">Scalable systems</li>
					</ul>
				</section>
				<section id="ci-cd">
					<h2>Continuous deployment</h2>
					<ul>
						<li class="fragment"><strong>Continuous integration</strong>
							<div>
								<label class="fragment">push/clone,</label>
								<label class="fragment">analysis,</label>
								<label class="fragment">pre-deployment testing,</label>
								<label class="fragment">packaging/deployment,</label>
								<label class="fragment">post-deployment testing</label>
							</div>
						</li>
						<li class="fragment"><strong>Continuous delivery</strong>
							<div>
								<label class="fragment">every commit <label class="fragment grow highlight-current-green">can be</label> deployed to production</label>
							</div>
						</li>
						<li class="fragment"><strong>Continuous deployment</strong>
							<div>
								<label class="fragment">every commit <label class="fragment grow highlight-current-green">is</label> deployed to production</label>
							</div>
						</li>
					</ul>
				</section>
				<section id="containers">
					<h2>Containers</h2>
					<blockquote>Shipping container is an object for holding or transporting something</blockquote>
					<ul>
						<li class="fragment">Isolated</li>
						<li class="fragment">Immutable</li>
						<li class="fragment">Reliable</li>
						<li class="fragment">Self-sufficient</li>
						<li class="fragment">Scalable</li>
					</ul>
				</section>
				<section id="monoliths" data-background="img/monolith.jpg">
					<h1>Monolithic applications</h1>
					<ul>
						<li class="fragment">Single unit</li>
						<li class="fragment">Time increases complexity and size</li>
						<li class="fragment">Time decreases development, testing and deployment speed</li>
						<li class="fragment">Layers</li>
						<li class="fragment">Change is hard and with risks</li>
						<li class="fragment">Scaling = multiplication of entire application</li>
					</ul>
				</section>
				<section>
					<section id="ms" data-background="img/code.jpg">
						<h1>Microservices</h1>
						<h4>Applications that fit into a screen</h4>
						<ul>
							<li class="fragment">System composed of small services</li>
							<li class="fragment">Autonomy/independence</li>
							<li class="fragment">Data exchange through APIs</li>
							<li class="fragment">Bounded context</li>
						</ul>
					</section>
					<section id="ms-ood">
						<h2>Object-Oriented Design</h2>
						<blockquote>
							The big idea is 'messaging'.
							The key in making great and growable systems is much more to design how its modules communicate rather than what their internal properties and behaviors should be.
							<br/><div style="float: right;">- Alan Kay</div>
						</blockquote>
					</section>
					<section id="ms-srp">
						<h2>Single Responsibility Principle</h2>
						<blockquote>
							Gather together those things that change for the same reason, and separate those things that change for different reasons
							<div style="float: right;">- Robert C. Martin</div>
						</blockquote>
					</section>
					<section id="ms-linux">
						<h2>Linux = Microservices</h2>
                    	<pre><code data-trim contenteditable>
						ps aux | grep jav[a] | awk '{print $2}' | xargs kill
						</code></pre>
					</section>
				</section>
				<section id="ms-keys">
					<h2>Microservices</h2>
					<h3>Key Aspects</h3>
					<ul>
						<li class="fragment">One thing or one functionality</li>
						<li class="fragment">Any tools or languages</li>
						<li class="fragment">Truly loosely coupled</li>
						<li class="fragment">Teams independence</li>
						<li class="fragment">Easier testing and CD</li>
						<li class="fragment">Decentralization</li>
					</ul>
				</section>
				<section id="ms-cons">
					<h2>Microservices</h2>
					<h4>Disadvantages</h4>
					<ul>
						<li class="fragment">Increased operational and deployment complexity
							<ul>
								<li class="fragment">Configuration Management</li>
								<li class="fragment">Containers (Docker)</li>
								<li class="fragment">Work shifted from development to DevOps</li>
							</ul>
						</li>
						<li class="fragment">Remote process calls</li>
					</ul>
				</section>
				<section id="ms-pros">
					<h2>Microservices</h2>
					<h4>Advantages</h4>
					<ul>
						<li class="fragment">Scaling</li>
						<li class="fragment">Resilience / fault isolation</li>
						<li class="fragment">Innovation</li>
						<li class="fragment">Size</li>
						<li class="fragment">Decoupling</li>
						<li class="fragment">Deployment</li>
						<li class="fragment">No need for long term commitment</li>
					</ul>
				</section>
				<section id="ms-bp">
					<h2>Microservices</h2>
					<h4>Best Practices</h4>
					<ul>
						<li class="fragment">Containers (Docker)</li>
						<li class="fragment">Reverse proxy</li>
						<li class="fragment">Minimalist approach</li>
						<li class="fragment">CM is a must</li>
						<li class="fragment">Cross functional teams</li>
						<li class="fragment">API versioning</li>
					</ul>
				</section>
				<section>
					<section id="deployment">
						<h2>Deployment</h2>
						<ul>
							<li class="fragment">Big vs small</li>
							<li class="fragment">Mutable vs immutable</li>
						</ul>
					</section>
					<section id="deployment-mutable">
						<h3>Deployment</h3>
						<h2>Mutable Monster Server</h2>
						<div>
							<img src="img/deployment_01_mutable_server.gif">
						</div>
					</section>
					<section id="deployment-immutable-server-01">
						<h3>Deployment</h3>
						<h2>Immutable Server</h2>
						<div>
							<img src="img/deployment_02_immutable_servers_01.gif">
						</div>
					</section>
					<section id="deployment-immutable-server-02">
						<h3>Deployment</h3>
						<h2>Immutable Server</h2>
						<div>
							<img src="img/deployment_02_immutable_servers_02.gif">
						</div>
					</section>
					<section id="deployment-immutable-server-03">
						<h3>Deployment</h3>
						<h2>Immutable Server</h2>
						<div>
							<img src="img/deployment_02_immutable_servers_03.gif">
						</div>
					</section>
					<section id="deployment-immutable-server-04">
						<h3>Deployment</h3>
						<h2>Immutable Server</h2>
						<div>
							<img src="img/deployment_02_immutable_servers_04.gif">
						</div>
					</section>
					<section id="deployment-immutable-ms-01">
						<h3>Deployment</h3>
						<h2>Immutable Micro Services</h2>
						<div>
							<img src="img/deployment_03_immutable_microservices_01.gif">
						</div>
					</section>
					<section id="deployment-immutable-ms-02">
						<h3>Deployment</h3>
						<h2>Immutable Micro Services</h2>
						<div>
							<img src="img/deployment_03_immutable_microservices_02.gif">
						</div>
					</section>
					<section id="deployment-immutable-ms-03">
						<h3>Deployment</h3>
						<h2>Immutable Micro Services</h2>
						<div>
							<img src="img/deployment_03_immutable_microservices_03.gif">
						</div>
					</section>
					<section id="deployment-immutable-ms-04">
						<h3>Deployment</h3>
						<h2>Immutable Micro Services</h2>
						<div>
							<img src="img/deployment_03_immutable_microservices_04.gif">
						</div>
					</section>
					<section id="deployment-immutable-ms-05">
						<h3>Deployment</h3>
						<h2>Immutable Micro Services</h2>
						<div>
							<img src="img/deployment_03_immutable_microservices_05.gif">
						</div>
					</section>
					<section id="deployment-immutable-ms-06">
						<h3>Deployment</h3>
						<h2>Immutable Micro Services</h2>
						<div>
							<img src="img/deployment_03_immutable_microservices_06.gif">
						</div>
					</section>
					<section id="deployment-immutable-ms-details-01">
						<h3>Deployment</h3>
						<h2>Immutable Micro Services Details</h2>
						<div>
							<img src="img/deployment_04_immutable_microservices_details_01.gif">
						</div>
					</section>
					<section id="deployment-immutable-ms-details-02">
						<h3>Deployment</h3>
						<h2>Immutable Micro Services Details</h2>
						<div>
							<img src="img/deployment_04_immutable_microservices_details_02.gif">
						</div>
					</section>
					<section id="deployment-immutable-ms-details-03">
						<h3>Deployment</h3>
						<h2>Immutable Micro Services Details</h2>
						<div>
							<img src="img/deployment_04_immutable_microservices_details_03.gif">
						</div>
					</section>
					<section id="deployment-immutable-ms-details-04">
						<h3>Deployment</h3>
						<h2>Immutable Micro Services Details</h2>
						<div>
							<img src="img/deployment_04_immutable_microservices_details_04.gif">
						</div>
					</section>
					<section id="deployment-immutable-ms-details-05">
						<h3>Deployment</h3>
						<h2>Immutable Micro Services Details</h2>
						<div>
							<img src="img/deployment_04_immutable_microservices_details_05.gif">
						</div>
					</section>
				</section>
				<section>
					<section id="dev">
						<h2>Development Environment</h2>
						<ul>
							<li class="fragment">Vagrant</li>
							<li class="fragment">Docker</li>
						</ul>
					</section>
					<section id="dev-vm">
						<h4>Development Environment</h4>
						<h2>Create Virtual Machine</h2>
						<pre><code data-trim contenteditable>
git clone https://github.com/vfarcic/books-ms.git
cd books-ms
vagrant plugin install vagrant-cachier
vagrant up dev
						</code></pre>
					</section>
					<section id="dev-vagrantfile">
						<h4>Development Environment</h4>
						<h2>Vagrantfile</h2>
						<pre><code data-trim contenteditable>
Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|
	config.vm.box = "ubuntu/trusty64"
	config.vm.synced_folder ".", "/vagrant"
	config.vm.provider "virtualbox" do |v|
		v.memory = 2048
	end
	config.vm.define :dev do |dev|
		dev.vm.provision :shell, path: "bootstrap.sh"
		dev.vm.provision :shell,
		inline: 'ansible-playbook \
			/vagrant/ansible/dev.yml -c local -v'
	end
	if Vagrant.has_plugin?("vagrant-cachier")
		config.cache.scope = :box
	end
end
						</code></pre>
					</section>
					<section id="dev-inside-vm">
						<h4>Development Environment</h4>
						<h2>Inside Virtual Machine</h2>
						<pre><code data-trim contenteditable>
vagrant ssh dev
ansible --version
docker --version
docker-compose --version
cd /vagrant
ll
						</code></pre>
					</section>
					<section id="dev-fe-tests">
						<h4>Development Environment</h4>
						<h2>Front-end tests</h2>
						<pre><code data-trim contenteditable>
sudo docker run -it \
	-v $PWD/client/components:/source/client/components \
	-v $PWD/client/test:/source/client/test \
	-v $PWD/src:/source/src \
	-v $PWD/target:/source/target \
	-v /data/tests/db:/data/db \
	-p 8080:8080 \
	--env TEST_TYPE=watch-front \
	vfarcic/books-ms-tests
						</code></pre>
					</section>
					<section id="dev-fe-tests-compose">
						<h4>Development Environment</h4>
						<h2>Tests with Docker Compose</h2>
						<pre><code data-trim contenteditable>
sudo docker-compose -f docker-compose-dev.yml up feTests

sudo docker-compose run tests
						</code></pre>
					</section>
					<section id="dev-stop-vm">
						<h4>Development Environment</h4>
						<h2>Stop the VM</h2>
						<pre><code data-trim contenteditable>
exit
vagrant halt dev
						</code></pre>
					</section>
				</section>
				<section>
					<section id="dp">
						<h2>Deployment Pipeline</h2>
						<ol>
							<li class="fragment">Checkout the code</li>
							<li class="fragment">Run pre-deployment tests</li>
							<li class="fragment">Compile and/or package the code</li>
							<li class="fragment">Build the container</li>
							<li class="fragment">Push the container to the registry</li>
							<li class="fragment">Deploy the container to the production server</li>
							<li class="fragment">Run post-deployment tests</li>
						</ol>
					</section>
					<section id="dp-env">
						<h4>Deployment Pipeline</h4>
						<h2>Creating CD VM</h2>
						<pre><code data-trim contenteditable>
cd ../
git clone https://github.com/vfarcic/ms-lifecycle.git
cd ms-lifecycle
vagrant up cd
vagrant ssh cd
						</code></pre>
					</section>
					<section id="dp-checkout">
						<h4>Deployment Pipeline</h4>
						<h2>Checking out the code</h2>
						<pre><code data-trim contenteditable>
git clone https://github.com/vfarcic/books-ms.git
cd books-ms
						</code></pre>
					</section>
					<section id="dp-pre-deployment-tests">
						<h4>Deployment Pipeline</h4>
						<h2>Running pre-deployment tests and compiling and/or packaging the code</h2>
						<pre><code data-trim contenteditable>
sudo docker-compose -f docker-compose-dev.yml run --rm tests
ll target/scala-2.10/
						</code></pre>
					</section>
					<section id="dp-building">
						<h4>Deployment Pipeline</h4>
						<h2>Building Docker containers</h2>
						<pre><code data-trim contenteditable>
cat Dockerfile

sudo docker build -t vfarcic/books-ms .
						</code></pre>
					</section>
					<section id="dp-running-1">
						<h4>Deployment Pipeline</h4>
						<h2>Running containers (Docker)</h2>
						<h3>Docker</h3>
						<pre><code data-trim contenteditable>
sudo docker run -d --name books-ms-db mongo

sudo docker run -d --name books-ms \
	-p 8080:8080 \
	--link books-ms-db:db \
	vfarcic/books-ms

sudo docker exec -it books-ms bash

env | grep DB

exit

sudo docker ps -a

sudo docker logs books-ms

sudo docker rm -f books-ms books-ms-db

sudo docker ps -a
						</code></pre>
					</section>
					<section id="dp-running-2">
						<h4>Deployment Pipeline</h4>
						<h2>Running containers</h2>
						<h3>Docker Compose</h3>
						<pre><code data-trim contenteditable>
sudo docker-compose -f docker-compose-dev.yml up -d app

cat docker-compose-dev.yml

sudo docker-compose ps

sudo docker ps -a

sudo docker-compose logs app
						</code></pre>
					</section>
					<section id="dp-running-3">
						<h4>Deployment Pipeline</h4>
						<h2>Running containers</h2>
						<h3>cURL</h3>
						<pre><code data-trim contenteditable>
curl -H 'Content-Type: application/json' -X PUT -d \
	'{"_id": 1,
	"title": "My First Book",
	"author": "John Doe",
	"description": "Not a very good book"}' \
	http://localhost:8080/api/v1/books | python -mjson.tool

curl -H 'Content-Type: application/json' -X PUT -d \
	'{"_id": 2,
	"title": "My Second Book",
	"author": "John Doe",
	"description": "Not a bad as the first book"}' \
	http://localhost:8080/api/v1/books | python -mjson.tool

curl -H 'Content-Type: application/json' -X PUT -d \
	'{"_id": 3,
	"title": "My Third Book",
	"author": "John Doe",
	"description": "Failed writers club"}' \
	http://localhost:8080/api/v1/books | python -mjson.tool

curl http://localhost:8080/api/v1/books | python -mjson.tool

curl http://localhost:8080/api/v1/books/_id/1 | python -mjson.tool
						</code></pre>
					</section>
					<section id="dp-registry">
						<h4>Deployment Pipeline</h4>
						<h2>Pushing containers to the registry</h2>
						<pre><code data-trim contenteditable>
sudo docker tag vfarcic/books-ms 10.100.198.200:5000/books-ms
sudo docker push 10.100.198.200:5000/books-ms
						</code></pre>
					</section>
					<section id="dp-checklist">
						<h2>Deployment Pipeline</h2>
						<ol>
							<li class="fragment"><strike>Checkout the code</strike></li>
							<li class="fragment"><strike>Run pre-deployment tests</strike></li>
							<li class="fragment"><strike>Compile and/or package the code</strike></li>
							<li class="fragment"><strike>Build the container</strike></li>
							<li class="fragment"><strike>Push the container to the registry</strike></li>
							<li class="fragment">Deploy the container to the production server</li>
							<li class="fragment">Run post-deployment tests</li>
						</ol>
					</section>
				</section>
				<section id="summary">
					<h2>Summary</h2>
					<h3>Not a silver bullet</h3>
				</section>
				<section id="qa" data-background="img/questions.jpg">
				</section>
				<section id="moreInfo">
					<h2>Additional Information</h2>
					<ul>
						<li>
							<a href="http://technologyconversations.com/2015/01/07/monolithic-servers-vs-microservices/">Monolithic Servers vs Microservices</a>
						</li>
					</ul>
				</section>
				<section>
					<section id="the-end" data-background="img/the_end.jpg">
						<h1>Viktor Farcic</h1>
						<h3><a href="https://twitter.com/vfarcic">@vfarcic</a></h3>
						<h4><a href="http://technologyconversations.com">technology conversations.com</a></h4>
					</section>
				</section>
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
