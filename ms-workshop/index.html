<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Microservices Lifecycle</title>

		<meta name="author" content="Viktor Farcic">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/viktor.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section id="cover">
					<h1>Microservices Lifecycle</h1>
					<p>
						<small>
							Created by <a href="http://technologyconversations.com/about/">Viktor Farcic</a>
							for <a href="http://technologyconversations.com">Technology Conversations</a> / <a href="http://twitter.com/vfarcic">@vfarcic</a>
						</small>
					</p>
				</section>
				<section id="about-me">
					<h2>Viktor Farcic</h2>
					<ul>
						<img src="img/viktor.jpg" style="float: right; width: 25%; height: 25%;"/>
						<li>Software Architect at <a href="http://everis.com">Everis</a></li>
						<li>Never developed in Fortran</li>
						<li>Passionate about microservices, continuous delivery, TDD, and BDD</li>
						<li>Blogger in <a href="http://technologyconversations.com/">Technology Conversations</a> and speaker at conferences</li>
						<li>Java Test-Driven Development: Mastering TDD Through Katas</li>
					</ul>
				</section>
				<section id="failures">
					<h2>History of the Failed Initiatives</h2>
					<h4>Continuous Integration (CI), Delivery and Deployment (CD)</h4>
					<ul>
						<li class="fragment">Integration phase = Dante's Infierno</li>
						<li class="fragment">eXtreme programming (XP)</li>
						<li class="fragment">Architecture</li>
						<li class="fragment">Testing</li>
						<li class="fragment">Orchestration</li>
						<li class="fragment">Deployments</li>
					</ul>
				</section>
				<section id="history">
					<h2>Things in Common</h2>
					<ul>
						<li class="fragment">Domain-driven design</li>
						<li class="fragment">Continuous integration/delivery/deployment</li>
						<li class="fragment">Containers</li>
						<li class="fragment">Small autonomous teams</li>
						<li class="fragment">Scalable systems</li>
					</ul>
				</section>
				<section>
					<section id="ci-cd">
						<h2>Continuous deployment</h2>
						<ul>
							<li class="fragment"><strong>Continuous integration</strong>
								<div>
									<label class="fragment">Push/clone,</label>
									<label class="fragment">Static analysis,</label>
									<label class="fragment">Pre-deployment testing,</label>
									<label class="fragment">Packaging/deployment,</label>
									<label class="fragment">Post-deployment testing</label>
								</div>
							</li>
							<li class="fragment"><strong>Continuous delivery</strong>
								<div>
									<label class="fragment">every commit <label class="fragment grow highlight-current-green">can be</label> deployed to production</label>
								</div>
							</li>
							<li class="fragment"><strong>Continuous deployment</strong>
								<div>
									<label class="fragment">every commit <label class="fragment grow highlight-current-green">is</label> deployed to production</label>
								</div>
							</li>
						</ul>
					</section>
					<section id="ci-process">
						<h4>Continuous deployment</h4>
						<h2>CI process</h2>
						<img src="img/ci.png">
					</section>
					<section id="ci-pipeline">
						<h4>Continuous deployment</h4>
						<h2>CI pipeline</h2>
						<img src="img/ci-pipeline.png">
					</section>
					<section id="cd-process">
						<h4>Continuous deployment</h4>
						<h2>Continuous delivery process</h2>
						<img src="img/cd.png">
					</section>
					<section id="cd-pipeline">
						<img src="img/cd-pipeline.png" style="width: 40%; height: 40%; float: right;">
						<h4>Continuous deployment</h4>
						<h2>Continuous deployment pipeline</h2>
					</section>
				</section>
				<section>
					<section id="containers">
						<h2>Containers (Docker)</h2>
						<blockquote>Shipping container is an object for holding or transporting something</blockquote>
						<img src="img/docker.png" style="float: right; width: 40%; height: 40%; background-color: white;">
						<ul>
							<li class="fragment">Isolated</li>
							<li class="fragment">Immutable</li>
							<li class="fragment">Reliable</li>
							<li class="fragment">Self-sufficient</li>
							<li class="fragment">Scalable</li>
						</ul>
					</section>
					<section id="containers-vms">
						<h4>Containers (Docker)</h4>
						<h2>VMs vs Containers</h2>
						<img src="img/containers-vms.png">
					</section>
					<section id="container-self-sufficient">
						<h4>Containers (Docker)</h4>
						<h2>Self-sufficient container</h2>
						<img src="img/container.png" style="width: 60%; height: 60%; ">
					</section>
					<section id="container-db">
						<h4>Containers (Docker)</h4>
						<h2>Container with the separate DB</h2>
						<img src="img/container-db.png" style="width: 90%; height: 90%; ">
					</section>
					<section id="container-shared-db">
						<h4>Containers (Docker)</h4>
						<h2>Containers with the shared DB</h2>
						<img src="img/container-shared-db.png" style="width: 70%; height: 70%; ">
					</section>
				</section>
				<section>
					<section id="monolith" data-background="img/monolith.jpg">
						<h2>Monolithic applications</h2>
						<ul>
							<li class="fragment">Single unit</li>
							<li class="fragment">Time increases complexity and size</li>
							<li class="fragment">Time decreases development, testing and deployment speed</li>
							<li class="fragment">Layers</li>
							<li class="fragment">Change is hard and with risks</li>
							<li class="fragment">Scaling = multiplication of the entire application</li>
						</ul>
					</section>
					<section id="monolith-simple">
						<h4>Monolithic applications</h4>
						<h2>Early</h2>
						<img src="img/monolith.png">
					</section>
					<section id="monolith-features">
						<h4>Monolithic applications</h4>
						<h2>Later</h2>
						<img src="img/monolith-features.png">
					</section>
					<section id="monolith-scaling">
						<h4>Monolithic applications</h4>
						<h2>Scaling</h2>
						<img src="img/monolith-scaling.png">
					</section>
				</section>
				<section>
					<section id="ms" data-background="img/code.jpg">
						<h2>Microservices</h2>
						<h4>Applications that fit into a screen</h4>
						<ul>
							<li class="fragment">System composed of small services</li>
							<li class="fragment">Autonomy/independence</li>
							<li class="fragment">Data exchange through APIs</li>
							<li class="fragment">Bounded context</li>
						</ul>
					</section>
					<section id="ms-diagram">
						<h4>Microservices</h4>
						<img src="img/microservices.png">
					</section>
					<section id="ms-ood">
						<h2>Object-Oriented Design</h2>
						<blockquote>
							The big idea is 'messaging'.
							The key in making great and growable systems is much more to design how its modules communicate rather than what their internal properties and behaviors should be.
							<br/><div style="float: right;">- Alan Kay</div>
						</blockquote>
					</section>
					<section id="ms-srp">
						<h2>Single Responsibility Principle</h2>
						<blockquote>
							Gather together those things that change for the same reason, and separate those things that change for different reasons
							<div style="float: right;">- Robert C. Martin</div>
						</blockquote>
					</section>
					<section id="ms-linux">
						<h2>Linux = Microservices</h2>
                    	<pre><code data-trim contenteditable>
						ps aux | grep jav[a] | awk '{print $2}' | xargs kill
						</code></pre>
					</section>
				</section>
				<section id="ms-keys">
					<h2>Microservices</h2>
					<h3>Key Aspects</h3>
					<ul>
						<li class="fragment">One thing or one functionality</li>
						<li class="fragment">Any tools or languages</li>
						<li class="fragment">Truly loosely coupled</li>
						<li class="fragment">Teams independence</li>
						<li class="fragment">Easier testing and CD</li>
						<li class="fragment">Decentralization</li>
					</ul>
				</section>
				<section id="ms-cons">
					<h2>Microservices</h2>
					<h4>Disadvantages</h4>
					<ul>
						<li class="fragment">Increased operational and deployment complexity
							<ul>
								<li class="fragment">Configuration Management</li>
								<li class="fragment">Containers (Docker)</li>
								<li class="fragment">Work shifted from development to DevOps</li>
							</ul>
						</li>
						<li class="fragment">Remote process calls</li>
					</ul>
				</section>
				<section id="ms-pros">
					<h2>Microservices</h2>
					<h4>Advantages</h4>
					<ul>
						<li class="fragment">Scaling</li>
						<li class="fragment">Resilience / fault isolation</li>
						<li class="fragment">Innovation</li>
						<li class="fragment">Size</li>
						<li class="fragment">Decoupling</li>
						<li class="fragment">Deployment</li>
						<li class="fragment">No need for long term commitment</li>
					</ul>
				</section>
				<section id="ms-bp">
					<h2>Microservices</h2>
					<h4>Best Practices</h4>
					<ul>
						<li class="fragment">Containers (Docker)</li>
						<li class="fragment">Reverse proxy</li>
						<li class="fragment">Minimalist approach</li>
						<li class="fragment">CM is a must</li>
						<li class="fragment">Cross functional teams</li>
						<li class="fragment">API versioning</li>
					</ul>
				</section>
				<section>
					<section id="deployment">
						<h2>Deployment</h2>
						<ul>
							<li class="fragment">Big vs small</li>
							<li class="fragment">Mutable vs immutable</li>
						</ul>
					</section>
					<section id="deployment-mutable">
						<h3>Deployment</h3>
						<h2>Mutable Monster Server</h2>
						<div>
							<img src="img/mutable-application-server.png">
						</div>
					</section>
					<section id="deployment-immutable-server-01" data-transition="fade-in slide-out">
						<h3>Deployment</h3>
						<h2>Immutable Server</h2>
						<div>
							<img src="img/immutable-application-server-01.png">
						</div>
					</section>
					<section id="deployment-immutable-server-02" data-transition="fade-in slide-out">
						<h3>Deployment</h3>
						<h2>Immutable Server</h2>
						<div>
							<img src="img/immutable-application-server-02.png">
						</div>
					</section>
					<section id="deployment-immutable-server-03" data-transition="fade-in slide-out">
						<h3>Deployment</h3>
						<h2>Immutable Server</h2>
						<div>
							<img src="img/immutable-application-server-03.png">
						</div>
					</section>
					<section id="deployment-immutable-server-04" data-transition="fade-in slide-out">
						<h3>Deployment</h3>
						<h2>Immutable Server</h2>
						<div>
							<img src="img/immutable-application-server-04.png">
						</div>
					</section>
					<section id="deployment-immutable-ms-01" data-transition="fade-in slide-out">
						<h3>Deployment</h3>
						<h2>Immutable Micro Services</h2>
						<div>
							<img src="img/immutable-microservices-01.png">
						</div>
					</section>
					<section id="deployment-immutable-ms-02" data-transition="fade-in slide-out">
						<h3>Deployment</h3>
						<h2>Immutable Micro Services</h2>
						<div>
							<img src="img/immutable-microservices-02.png">
						</div>
					</section>
					<section id="deployment-immutable-ms-03" data-transition="fade-in slide-out">
						<h3>Deployment</h3>
						<h2>Immutable Micro Services</h2>
						<div>
							<img src="img/immutable-microservices-03.png">
						</div>
					</section>
					<section id="deployment-immutable-ms-04" data-transition="fade-in slide-out">
						<h3>Deployment</h3>
						<h2>Immutable Micro Services</h2>
						<div>
							<img src="img/immutable-microservices-04.png">
						</div>
					</section>
				</section>
				<section>
					<section id="dev">
						<h2>Development Environment</h2>
						<ul>
							<li class="fragment">Vagrant</li>
							<li class="fragment">Docker</li>
						</ul>
					</section>
					<section id="dev-vm">
						<h4>Development Environment</h4>
						<h2>Create Virtual Machine</h2>
						<pre><code data-trim contenteditable>
git clone https://github.com/vfarcic/books-ms.git
cd books-ms
vagrant plugin install vagrant-cachier
vagrant up dev
						</code></pre>
					</section>
					<section id="dev-vagrantfile">
						<h4>Development Environment</h4>
						<h2>Vagrantfile</h2>
						<pre><code data-trim contenteditable>
Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|
	config.vm.box = "ubuntu/trusty64"
	config.vm.synced_folder ".", "/vagrant"
	config.vm.provider "virtualbox" do |v|
		v.memory = 2048
	end
	config.vm.define :dev do |dev|
		dev.vm.provision :shell, path: "bootstrap.sh"
		dev.vm.provision :shell,
		inline: 'ansible-playbook \
			/vagrant/ansible/dev.yml -c local -v'
	end
	if Vagrant.has_plugin?("vagrant-cachier")
		config.cache.scope = :box
	end
end
						</code></pre>
					</section>
					<section id="dev-inside-vm">
						<h4>Development Environment</h4>
						<h2>Inside Virtual Machine</h2>
						<pre><code data-trim contenteditable>
vagrant ssh dev
ansible --version
docker --version
docker-compose --version
cd /vagrant
ll
						</code></pre>
					</section>
					<section id="dev-fe-tests">
						<h4>Development Environment</h4>
						<h2>Front-end tests</h2>
						<pre><code data-trim contenteditable>
sudo docker run -it \
	-v $PWD/client/components:/source/client/components \
	-v $PWD/client/test:/source/client/test \
	-v $PWD/src:/source/src \
	-v $PWD/target:/source/target \
	-v /data/tests/db:/data/db \
	-p 8080:8080 \
	--env TEST_TYPE=watch-front \
	vfarcic/books-ms-tests
						</code></pre>
					</section>
					<section id="dev-fe-tests-compose">
						<h4>Development Environment</h4>
						<h2>Tests with Docker Compose</h2>
						<pre><code data-trim contenteditable>
sudo docker-compose -f docker-compose-dev.yml up feTestsLocal

sudo docker-compose -f docker-compose-dev.yml run testsLocal
						</code></pre>
					</section>
					<section id="dev-stop-vm">
						<h4>Development Environment</h4>
						<h2>Stop the VM</h2>
						<pre><code data-trim contenteditable>
exit
vagrant halt dev
						</code></pre>
					</section>
				</section>
				<section>
					<section id="dp">
						<h2>Deployment Pipeline</h2>
						<ol>
							<li class="fragment">Checkout the code</li>
							<li class="fragment">Run pre-deployment tests</li>
							<li class="fragment">Compile and/or package the code</li>
							<li class="fragment">Build the container</li>
							<li class="fragment">Push the container to the registry</li>
							<li class="fragment">Deploy the container to the production server</li>
							<li class="fragment">Integrate the container</li>
							<li class="fragment">Run post-deployment tests</li>
						</ol>
					</section>
					<section id="dp-env">
						<h4>Deployment Pipeline</h4>
						<h2>Creating CD VM</h2>
						<pre><code data-trim contenteditable>
cd ../
git clone https://github.com/vfarcic/ms-lifecycle.git
cd ms-lifecycle
vagrant up cd prod
vagrant ssh cd
						</code></pre>
					</section>
					<section id="dp-checkout">
						<h4>Deployment Pipeline</h4>
						<h2>Checking out the code</h2>
						<pre><code data-trim contenteditable>
git clone https://github.com/vfarcic/books-ms.git
cd books-ms
						</code></pre>
					</section>
					<section id="dp-pre-deployment-tests">
						<h4>Deployment Pipeline</h4>
						<h2>Running pre-deployment tests and compiling and/or packaging the code</h2>
						<pre><code data-trim contenteditable>
sudo docker-compose -f docker-compose-dev.yml run --rm testsLocal
ll target/scala-2.10/
						</code></pre>
					</section>
					<section id="dp-building">
						<h4>Deployment Pipeline</h4>
						<h2>Building Docker containers</h2>
						<pre><code data-trim contenteditable>
cat Dockerfile

sudo docker build -t vfarcic/books-ms .
						</code></pre>
					</section>
					<section id="dp-running-1">
						<h4>Deployment Pipeline</h4>
						<h2>Running containers (Docker)</h2>
						<h3>Docker</h3>
						<pre><code data-trim contenteditable>
sudo docker run -d --name books-ms-db mongo

sudo docker run -d --name books-ms \
	-p 8080:8080 \
	--link books-ms-db:db \
	vfarcic/books-ms

sudo docker exec -it books-ms bash

env | grep DB

exit

sudo docker ps -a

sudo docker logs books-ms

sudo docker rm -f books-ms books-ms-db

sudo docker ps -a
						</code></pre>
					</section>
					<section id="dp-running-2">
						<h4>Deployment Pipeline</h4>
						<h2>Running containers</h2>
						<h3>Docker Compose</h3>
						<pre><code data-trim contenteditable>
sudo docker-compose -f docker-compose-dev.yml up -d appLocal

cat docker-compose-dev.yml

sudo docker-compose ps

sudo docker ps -a

sudo docker-compose logs app
						</code></pre>
					</section>
					<section id="dp-running-3">
						<h4>Deployment Pipeline</h4>
						<h2>Running containers</h2>
						<h3>cURL</h3>
						<pre><code data-trim contenteditable>
curl -H 'Content-Type: application/json' -X PUT -d \
	'{"_id": 1,
	"title": "My First Book",
	"author": "John Doe",
	"description": "Not a very good book"}' \
	http://localhost:8080/api/v1/books | python -mjson.tool

curl -H 'Content-Type: application/json' -X PUT -d \
	'{"_id": 2,
	"title": "My Second Book",
	"author": "John Doe",
	"description": "Not a bad as the first book"}' \
	http://localhost:8080/api/v1/books | python -mjson.tool

curl -H 'Content-Type: application/json' -X PUT -d \
	'{"_id": 3,
	"title": "My Third Book",
	"author": "John Doe",
	"description": "Failed writers club"}' \
	http://localhost:8080/api/v1/books | python -mjson.tool

curl http://localhost:8080/api/v1/books | python -mjson.tool

curl http://localhost:8080/api/v1/books/_id/1 | python -mjson.tool
						</code></pre>
					</section>
					<section id="dp-registry">
						<h4>Deployment Pipeline</h4>
						<h2>Pushing containers to the registry</h2>
						<pre><code data-trim contenteditable>
sudo docker tag vfarcic/books-ms 10.100.198.200:5000/books-ms
sudo docker push 10.100.198.200:5000/books-ms
						</code></pre>
					</section>
					<section id="dp-checklist">
						<h2>Deployment Pipeline</h2>
						<ol>
							<li class="fragment"><strike>Checkout the code</strike></li>
							<li class="fragment"><strike>Run pre-deployment tests</strike></li>
							<li class="fragment"><strike>Compile and/or package the code</strike></li>
							<li class="fragment"><strike>Build the container</strike></li>
							<li class="fragment"><strike>Push the container to the registry</strike></li>
							<li class="fragment">Deploy the container to the production server</li>
							<li class="fragment">Integrate the container</li>
							<li class="fragment">Run post-deployment tests</li>
						</ol>
					</section>
				</section>
				<section>
					<section id="cm">
						<h2>Configuration Management in the Docker World</h2>
						<ol>
							<li class="fragment">CFEngine</li>
							<li class="fragment">Puppet</li>
							<li class="fragment">Chef</li>
							<li class="fragment"><label class="fragment grow highlight-current-green">Ansible</label></li>
						</ol>
					</section>
					<section id="cm-prod">
						<h4>Configuration Management in the Docker World</h4>
						<h2>Configuring the Production Environment</h2>
						<pre><code data-trim contenteditable>
cd /vagrant/ansible

ansible-playbook prod.yml -i hosts/prod

ansible-playbook prod.yml -i hosts/prod
						</code></pre>
					</section>
					<section id="cm-playbook">
						<h4>Configuration Management in the Docker World</h4>
						<h2>Production environment Ansible playbook</h2>
						<pre><code data-trim contenteditable>
cat prod.yml

cat roles/docker/tasks/main.yml

cat hosts/prod
						</code></pre>
					</section>
				</section>
				<section>
					<section id="dp2">
						<h2>Deployment Pipeline (Part 2)</h2>
						<ol>
							<li class="fragment"><strike>Checkout the code</strike></li>
							<li class="fragment"><strike>Run pre-deployment tests</strike></li>
							<li class="fragment"><strike>Compile and/or package the code</strike></li>
							<li class="fragment"><strike>Build the container</strike></li>
							<li class="fragment"><strike>Push the container to the registry</strike></li>
							<li class="fragment">Deploy the container to the production server</li>
							<li class="fragment">Integrate the container</li>
							<li class="fragment">Run post-deployment tests</li>
						</ol>
					</section>
					<section id="dp2-deploy">
						<h4>Deployment Pipeline (Part 2)</h4>
						<h2>Deploying containers to the production server</h2>
						<pre><code data-trim contenteditable>
ssh-keygen # Answer with the Enter key to all questions

ssh-copy-id 10.100.198.201 # Use vagrant as the password

ssh 10.100.198.201

GITHUB_OWNER=vfarcic

SERVICE_NAME=books-ms

wget https://raw.githubusercontent.com/$GITHUB_OWNER/$SERVICE_NAME/master/docker-compose.yml

cat docker-compose.yml

sudo docker-compose up --allow-insecure-ssl -d app
						</code></pre>
					</section>
					<section id="dp2-verification">
						<h4>Deployment Pipeline (Part 2)</h4>
						<h2>Post-deployment verification</h2>
						<pre><code data-trim contenteditable class="nohighlight">
sudo docker inspect vagrant_app_1

PORT=$(sudo docker inspect \
	--format='{{(index (index .NetworkSettings.Ports "8080/tcp") 0).HostPort}}' \
	vagrant_app_1)
	echo $PORT

curl -H 'Content-Type: application/json' -X PUT -d \
	"{\"_id\": 1,
	\"title\": \"My First Book\",
	\"author\": \"John Doe\",
	\"description\": \"Not a very good book\"}" \
	http://localhost:$PORT/api/v1/books | python -mjson.tool

curl -H 'Content-Type: application/json' -X PUT -d \
	"{\"_id\": 2,
	\"title\": \"My Second Book\",
	\"author\": \"John Doe\",
	\"description\": \"Not a bad as the first book\"}" \
	http://localhost:$PORT/api/v1/books | python -mjson.tool

curl -H 'Content-Type: application/json' -X PUT -d \
	"{\"_id\": 3,
	\"title\": \"My Third Book\",
	\"author\": \"John Doe\",
	\"description\": \"Failed writers club\"}" \
	http://localhost:$PORT/api/v1/books | python -mjson.tool

curl http://localhost:$PORT/api/v1/books | python -mjson.tool

curl http://localhost:$PORT/api/v1/books/_id/1 | python -mjson.tool
						</code></pre>
					</section>
					<section id="dp2-exit">
						<h4>Deployment Pipeline (Part 2)</h4>
						<h2>Stopping Production Node</h2>
						<pre><code data-trim contenteditable class="nohighlight">
exit # Exit prod
exit # Exit cd
vagrant halt prod # Stop prod VM
						</code></pre>
					</section>
					<section id="dp2-checklist">
						<h2>Deployment Pipeline (Part 2)</h2>
						<ol>
							<li class="fragment"><strike>Checkout the code</strike></li>
							<li class="fragment"><strike>Run pre-deployment tests</strike></li>
							<li class="fragment"><strike>Compile and/or package the code</strike></li>
							<li class="fragment"><strike>Build the container</strike></li>
							<li class="fragment"><strike>Push the container to the registry</strike></li>
							<li class="fragment"><strike>Deploy the container to the production server</strike></li>
							<li class="fragment">Integrate the container</li>
							<li class="fragment">Run post-deployment tests</li>
						</ol>
					</section>
				</section>
				<section>
					<section id="sd">
						<h2>Service Discovery</h2>
						<ol>
							<li class="fragment">Service registration</li>
							<li class="fragment">Service discovery</li>
						</ol>
					</section>
					<section id="sd-single-node">
						<h4>Service Discovery</h4>
						<h2>Single node</h2>
						<img src="img/single-node-docker.png">
					</section>
					<section id="sd-multie-node">
						<h4>Service Discovery</h4>
						<h2>Multiple nodes</h2>
						<img src="img/multi-node-docker.png">
					</section>
					<section id="sd-tools">
						<h4>Service Discovery</h4>
						<h2>Tools</h2>
						<ol>
							<li class="fragment">Manual configuration</li>
							<li class="fragment">Zookeeper</li>
							<li class="fragment">etcd / Registrator / confd</li>
							<li class="fragment">Consul / Registrator / consul-template</li>
						</ol>
					</section>
					<section id="sd-consul-playbook">
						<h4>Service Discovery</h4>
						<h2>Consul Ansible playbook</h2>
						<pre><code data-trim contenteditable>
vagrant up serv-disc-01 serv-disc-02 serv-disc-03

vagrant ssh cd

cat /vagrant/ansible/hosts/serv-disc

cat /vagrant/ansible/roles/consul/tasks/main.yml

cat /vagrant/ansible/roles/consul/defaults/main.yml

cat /vagrant/ansible/host_vars/10.100.197.201

cat /vagrant/ansible/consul.yml
						</code></pre>
					</section>
					<section id="sd-consul-setup">
						<h4>Service Discovery</h4>
						<h2>Setting up Consul</h2>
						<pre><code data-trim contenteditable>
ansible-playbook \
	/vagrant/ansible/consul.yml \
	-i /vagrant/ansible/hosts/serv-disc

curl 10.100.197.201:8500/v1/catalog/nodes \
	| python -mjson.tool
						</code></pre>
					</section>
					<section id="sd-consul-diagram">
						<h4>Service Discovery</h4>
						<h2>Consul</h2>
						<img src="img/consul.png">
					</section>
					<section id="sd-kv-put">
						<h4>Service Discovery</h4>
						<h2>Key/value store: PUT</h2>
						<pre><code data-trim contenteditable>
curl -X PUT -d 'this is a test' \
	http://10.100.197.201:8500/v1/kv/msg1

curl -X PUT -d 'this is another test' \
	http://10.100.197.202:8500/v1/kv/messages/msg2

curl -X PUT -d 'this is a test with flags' \
	http://10.100.197.203:8500/v1/kv/messages/msg3?flags=1234
						</code></pre>
					</section>
					<section id="sd-kv-get-delete">
						<h4>Service Discovery</h4>
						<h2>Key/value store: GET/DELETE</h2>
						<pre><code data-trim contenteditable>
curl http://10.100.197.203:8500/v1/kv/?recurse \
	| python -mjson.tool

curl http://10.100.197.202:8500/v1/kv/msg1 \
	| python -mjson.tool

curl http://10.100.197.201:8500/v1/kv/msg1?raw

curl -X DELETE http://10.100.197.201:8500/v1/kv/messages/msg2

curl -X DELETE http://10.100.197.202:8500/v1/kv/?recurse
						</code></pre>
					</section>
					<section id="sd-registrator-playbook">
						<h4>Service Discovery</h4>
						<h2>Registrator Ansible playbook</h2>
						<pre><code data-trim contenteditable>
cat /vagrant/ansible/roles/registrator/tasks/main.yml

cat /vagrant/ansible/roles/registrator/defaults/main.yml
						</code></pre>
					</section>
					<section id="sd-registrator-setup">
						<h4>Service Discovery</h4>
						<h2>Setting up Registrator</h2>
						<pre><code data-trim contenteditable>
ansible-playbook \
	/vagrant/ansible/registrator.yml \
	-i /vagrant/ansible/hosts/serv-disc
						</code></pre>
					</section>
					<section id="sd-consul-registrator-diagram">
						<h4>Service Discovery</h4>
						<h2>Consul / Registrator</h2>
						<img src="img/consul-registrator.png">
					</section>
					<section id="sd-nginx">
						<h4>Service Discovery</h4>
						<h2>Registering service</h2>
						<pre><code data-trim contenteditable>
exit # Exit cd

vagrant ssh serv-disc-01

sudo docker run -d --name nginx \
	--env SERVICE_NAME=nginx \
	--env SERVICE_ID=nginx \
	-p 1234:80 \
	nginx

curl http://10.100.197.201:8500/v1/catalog/service/nginx \
	| python -mjson.tool
						</code></pre>
					</section>
					<section id="sd-nginx2">
						<h4>Service Discovery</h4>
						<h2>Registering service again</h2>
						<pre><code data-trim contenteditable>
sudo docker run -d --name nginx2 \
	--env "SERVICE_ID=nginx2" \
	--env "SERVICE_NAME=nginx" \
	--env "SERVICE_TAGS=balancer,proxy,www" \
	-p 1111:80 \
	nginx

curl http://localhost:8500/v1/catalog/service/nginx \
	| python -mjson.tool
						</code></pre>
					</section>
					<section id="sd-consul-template-playbook">
						<h4>Service Discovery</h4>
						<h2>consul-template Ansible playbook</h2>
						<pre><code data-trim contenteditable>
cat /vagrant/ansible/roles/consul-template/tasks/main.yml

cat /vagrant/ansible/consul-template.yml
						</code></pre>
					</section>
					<section id="sd-consul-template-setup">
						<h4>Service Discovery</h4>
						<h2>Setting up consul-template</h2>
						<pre><code data-trim contenteditable>
ansible-playbook \
	/vagrant/ansible/consul-template.yml \
	-i /vagrant/ansible/hosts/serv-disc
						</code></pre>
					</section>
					<section id="sd-consul-registrator-consul-template-diagram">
						<h4>Service Discovery</h4>
						<h2>Consul / Registrator / consul-template</h2>
						<img src="img/consul-registrator-consul-template.png">
					</section>
					<section id="sd-consul-template-run">
						<h4>Service Discovery</h4>
						<h2>Running consul-template</h2>
						<pre><code data-trim contenteditable>
exit # Exit cd node

vagrant ssh serv-disc-01 # Enter serv-disc-01

curl http://localhost:8500/v1/catalog/service/nginx \
	| python -mjson.tool

consul-template \
	-consul localhost:8500 \
	-template "/data/consul-template/example.ctmpl\
:/tmp/example.conf" \
	-once

cat /tmp/example.conf
						</code></pre>
					</section>
				</section>
				<section id="summary">
					<h2>Summary</h2>
					<h3>Not a silver bullet</h3>
				</section>
				<section id="qa" data-background="img/questions.jpg">
				</section>
				<section id="moreInfo">
					<h2>Additional Information</h2>
					<ul>
						<li>
							<a href="http://technologyconversations.com/2015/01/07/monolithic-servers-vs-microservices/">Monolithic Servers vs Microservices</a>
						</li>
					</ul>
				</section>
				<section>
					<section id="the-end" data-background="img/the_end.jpg">
						<h1>Viktor Farcic</h1>
						<h3><a href="https://twitter.com/vfarcic">@vfarcic</a></h3>
						<h4><a href="http://technologyconversations.com">technology conversations.com</a></h4>
					</section>
				</section>
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
